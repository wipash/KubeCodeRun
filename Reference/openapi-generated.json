{
  "openapi": "3.1.0",
  "info": {
    "title": "Code Interpreter API",
    "description": "A secure API for executing code in isolated environments",
    "version": "1.0.0"
  },
  "paths": {
    "/health": {
      "get": {
        "tags": ["health", "monitoring"],
        "summary": "Basic health check",
        "description": "Basic health check endpoint that doesn't require authentication.",
        "operationId": "basic_health_check_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/config": {
      "get": {
        "summary": "Config Info",
        "description": "Configuration information endpoint (non-sensitive data only).",
        "operationId": "config_info_config_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/upload": {
      "post": {
        "tags": ["files"],
        "summary": "Upload File",
        "description": "Upload files with multipart form handling - LibreChat compatible.\n\nAccepts files in either 'file' (singular) or 'files' (plural) field names.\nLibreChat uses 'file' while our tests use 'files'.",
        "operationId": "upload_file_upload_post",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/Body_upload_file_upload_post"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/files/{session_id}": {
      "get": {
        "tags": ["files"],
        "summary": "List Files",
        "description": "List all files in a session with optional detail parameter - LibreChat compatible.",
        "operationId": "list_files_files__session_id__get",
        "parameters": [
          {
            "name": "session_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Session Id"
            }
          },
          {
            "name": "detail",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Detail level: 'simple' for basic info, otherwise full details",
              "title": "Detail"
            },
            "description": "Detail level: 'simple' for basic info, otherwise full details"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/download/{session_id}/{file_id}": {
      "get": {
        "tags": ["files"],
        "summary": "Download File",
        "description": "Download a file directly - LibreChat compatible.",
        "operationId": "download_file_download__session_id___file_id__get",
        "parameters": [
          {
            "name": "session_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Session Id"
            }
          },
          {
            "name": "file_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "File Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      },
      "options": {
        "tags": ["files"],
        "summary": "Download File Options",
        "description": "Handle OPTIONS preflight request for download endpoint.",
        "operationId": "download_file_options_download__session_id___file_id__options",
        "parameters": [
          {
            "name": "session_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Session Id"
            }
          },
          {
            "name": "file_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "File Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/files/{session_id}/{file_id}": {
      "delete": {
        "tags": ["files"],
        "summary": "Delete File",
        "description": "Delete a file from the session - LibreChat compatible.",
        "operationId": "delete_file_files__session_id___file_id__delete",
        "parameters": [
          {
            "name": "session_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Session Id"
            }
          },
          {
            "name": "file_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "File Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/exec": {
      "post": {
        "tags": ["exec"],
        "summary": "Execute Code",
        "description": "Execute code with specified language and parameters.\n\nThis endpoint is compatible with LibreChat's Code Interpreter API.\nIt supports 12 programming languages: py, js, ts, go, java, c, cpp, php, rs, r, f90, d\n\nPython sessions support state persistence - variables and functions defined in\none execution are available in subsequent executions within the same session.\nState is stored in Redis (2 hour TTL) with automatic archival to MinIO for\nlong-term storage (7 day TTL).\n\nArgs:\n    request: Execution request with code, language, and optional files\n    session_service: Session management service\n    file_service: File storage service\n    execution_service: Code execution service\n    state_service: Python state persistence service (Redis)\n    state_archival_service: Python state archival service (MinIO)\n\nReturns:\n    ExecResponse with session_id, stdout, stderr, and generated files",
        "operationId": "execute_code_exec_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExecRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExecResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/health/detailed": {
      "get": {
        "tags": ["health", "monitoring"],
        "summary": "Detailed health check",
        "description": "Detailed health check of all system dependencies.",
        "operationId": "detailed_health_check_health_detailed_get",
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "parameters": [
          {
            "name": "use_cache",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "Use cached health check results",
              "default": true,
              "title": "Use Cache"
            },
            "description": "Use cached health check results"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/health/redis": {
      "get": {
        "tags": ["health", "monitoring"],
        "summary": "Redis health check",
        "description": "Check Redis connectivity and performance.",
        "operationId": "redis_health_check_health_redis_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/health/minio": {
      "get": {
        "tags": ["health", "monitoring"],
        "summary": "MinIO health check",
        "description": "Check MinIO/S3 connectivity and performance.",
        "operationId": "minio_health_check_health_minio_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/health/docker": {
      "get": {
        "tags": ["health", "monitoring"],
        "summary": "Docker health check",
        "description": "Check Docker daemon connectivity and performance.",
        "operationId": "docker_health_check_health_docker_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/metrics": {
      "get": {
        "tags": ["health", "monitoring"],
        "summary": "System metrics",
        "description": "Get system metrics and statistics.",
        "operationId": "get_metrics_metrics_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/metrics/execution": {
      "get": {
        "tags": ["health", "monitoring"],
        "summary": "Execution metrics",
        "description": "Get code execution metrics and statistics.",
        "operationId": "get_execution_metrics_metrics_execution_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/metrics/api": {
      "get": {
        "tags": ["health", "monitoring"],
        "summary": "API metrics",
        "description": "Get API request metrics and statistics.",
        "operationId": "get_api_metrics_metrics_api_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/status": {
      "get": {
        "tags": ["health", "monitoring"],
        "summary": "Service status",
        "description": "Get comprehensive service status information.",
        "operationId": "get_service_status_status_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "Body_upload_file_upload_post": {
        "properties": {
          "file": {
            "anyOf": [
              {
                "type": "string",
                "format": "binary"
              },
              {
                "type": "null"
              }
            ],
            "title": "File"
          },
          "files": {
            "anyOf": [
              {
                "items": {
                  "type": "string",
                  "format": "binary"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Files"
          },
          "entity_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Entity Id"
          }
        },
        "type": "object",
        "title": "Body_upload_file_upload_post"
      },
      "ExecRequest": {
        "properties": {
          "code": {
            "type": "string",
            "title": "Code",
            "description": "The source code to be executed"
          },
          "lang": {
            "type": "string",
            "title": "Lang",
            "description": "The programming language of the code"
          },
          "args": {
            "anyOf": [
              {},
              {
                "type": "null"
              }
            ],
            "title": "Args",
            "description": "Optional command line arguments (any JSON type)"
          },
          "user_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "User Id",
            "description": "Optional user identifier"
          },
          "entity_id": {
            "anyOf": [
              {
                "type": "string",
                "maxLength": 40,
                "pattern": "^[A-Za-z0-9_-]+$"
              },
              {
                "type": "null"
              }
            ],
            "title": "Entity Id",
            "description": "Optional assistant/agent identifier for file sharing"
          },
          "session_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Session Id",
            "description": "Optional session ID to continue an existing session (for state persistence)"
          },
          "files": {
            "anyOf": [
              {
                "items": {
                  "$ref": "#/components/schemas/RequestFile"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Files",
            "description": "Array of file references to be used during execution"
          }
        },
        "type": "object",
        "required": ["code", "lang"],
        "title": "ExecRequest",
        "description": "Request model for /exec endpoint."
      },
      "ExecResponse": {
        "properties": {
          "session_id": {
            "type": "string",
            "title": "Session Id"
          },
          "files": {
            "items": {
              "$ref": "#/components/schemas/FileRef"
            },
            "type": "array",
            "title": "Files"
          },
          "stdout": {
            "type": "string",
            "title": "Stdout",
            "default": ""
          },
          "stderr": {
            "type": "string",
            "title": "Stderr",
            "default": ""
          }
        },
        "type": "object",
        "required": ["session_id"],
        "title": "ExecResponse",
        "description": "Response model for /exec endpoint - LibreChat compatible format."
      },
      "FileRef": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "name": {
            "type": "string",
            "title": "Name"
          },
          "path": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Path"
          }
        },
        "type": "object",
        "required": ["id", "name"],
        "title": "FileRef",
        "description": "File reference model for execution response."
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "RequestFile": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "session_id": {
            "type": "string",
            "title": "Session Id"
          },
          "name": {
            "type": "string",
            "title": "Name"
          }
        },
        "type": "object",
        "required": ["id", "session_id", "name"],
        "title": "RequestFile",
        "description": "Request file model."
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": ["loc", "msg", "type"],
        "title": "ValidationError"
      }
    },
    "securitySchemes": {
      "HTTPBearer": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  }
}
